(function(){window.onload=function(){BM.init()};var BM=window.BM={ticker:null,stage:null,tween:Hilo.Tween,asset:null,scenes:{},land:null,s1Ready:false,s1NeedRunned:false,s3Ready:false,s3NeedRunned:false,init:function(){var self=this;self.stage=new Hilo.Stage({renderType:"canvas",container:document.body,width:BM.utils.getWidth(),height:BM.utils.getHeight(),background:"#e3ece9"});self.ticker=new Hilo.Ticker(20);self.ticker.addTick(self.stage);self.ticker.addTick(self.tween);self.ticker.start();self.asset=new BM.Asset();var loading=new BM.Loading();self.asset.on("stage1",function(){loading.stop();self.stage.removeChild(loading);self.startFlow()});self.asset.on("stage2",function(){self.s1Ready=true;if(self.s1NeedRunned){self.loadNext(this.curStageId)}});self.asset.on("stage3",function(){self.s3Ready=true;if(self.s3NeedRunned){self.loadNext(this.curStageId)}});self.stage.addChild(loading);loading.start();self.asset.load()},startFlow:function(){this.pre=new BM.scenes.Land(this.asset.get("land"));this.stage.addChild(this.pre);this.pre.start()},loadNext:function(nextId){var self=this;if(nextId==="s1"&&!self.s1Ready){self.curStageId=nextId;self.s1NeedRunned=true;return}if(nextId==="s3"&&!self.s3Ready){self.curStageId=nextId;self.s3NeedRunned=true;return}if(!nextId){nextId=self.curStageId}console.log("nid:",nextId,self.curStageId);self["next"+nextId]=new BM.scenes["next"+nextId](self.asset.get(nextId));self.stage.addChild(self["next"+nextId]);self["next"+nextId].start()}}})();(function(bm){bm.utils={getWidth:function(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth},getHeight:function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}}})(window.BM);(function(bm){var Asset=bm.Asset=Hilo.Class.create({Mixes:Hilo.EventMixin,firstQueue:null,resStage1:[{id:"land",src:"images/land.jpg"},{id:"square",src:"images/square.png"},{id:"rose",src:"images/rose.png"}],resStage2:[{id:"s1",src:"images/1.jpg"},{id:"s2",src:"images/2.jpg"},{id:"s3",src:"images/3.jpg"},{id:"s4",src:"images/4.jpg"}],resStage3:[{id:"s5",src:"images/5.jpg"},{id:"s6",src:"images/6.jpg"},{id:"s7",src:"images/7.jpg"}],load:function(){var self=this;self.firstQueue=new Hilo.LoadQueue(this.resStage1);self.firstQueue.on("complete",function(){self.firstQueue.off("complete");self.fire("stage1");self.stage2()});self.firstQueue.start()},stage2:function(){var self=this;self.firstQueue.add(this.resStage2);self.firstQueue.on("complete",function(){self.firstQueue.off("complete");self.fire("stage2");self.stage3()});self.firstQueue.start()},stage3:function(){var self=this;self.firstQueue.add(this.resStage3);self.firstQueue.on("complete",function(){self.firstQueue.off("complete");self.fire("stage3")});self.firstQueue.start()},get:function(id){return this.firstQueue.get(id)},rate:function(){var loaded=this.firstQueue.getLoaded();var total=this.firstQueue.getTotal();if(!total){return"0%"}var rate=parseInt((loaded/total).toFixed(2)*100);return rate+"%"}})})(window.BM);(function(bm){var Loading=bm.Loading=Hilo.Class.create({Extends:Hilo.Text,loadInterval:null,constructor:function(obj){Loading.superclass.constructor.call(this,obj);this.align=Hilo.align.CENTER;this.text="0%";this.color="#2b4716";this.font="40px 微软雅黑";this.width=40;this.height=40},start:function(){var self=this;this.loadInterval=setInterval(function(){self.text=bm.asset.rate()},5)},stop:function(){clearInterval(this.loadInterval)}})})(window.BM);(function(bm){var Land=bm.scenes.Land=Hilo.Class.create({Extends:Hilo.Container,Mixes:Hilo.EventMixin,enterEase:Hilo.Ease.Linear.EaseNone,outEase:Hilo.Ease.Linear.EaseNone,constructor:function(bg){this.bmp=this.toBitmap(bg);Land.superclass.constructor.call(this,{children:[this.bmp]});this.alpha=0;this.width=this.bmp.width;this.height=this.bmp.height;this.x=-250;this.y=-200;this.scaleX=1.6;this.scaleY=1.6},toBitmap:function(img){var content=img.content;return new Hilo.Bitmap({id:img.id,image:content,width:content.width,height:content.height,rect:[0,0,content.width,content.height]})},start:function(){var self=this;bm.tween.to(self,{x:-100,y:-10,scaleX:1,scaleY:1,alpha:0.8},{duration:3000,ease:self.enterEase,onComplete:function(){self.createSquare()}})},createSquare:function(){var self=this;self.square=self.toBitmap(bm.asset.get("square"));self.square.scaleX=0.8;self.square.scaleY=0.8;self.alpha=0.8;self.square.x=(bm.stage.width-self.square.width*0.8)/2;self.square.y=bm.stage.height;bm.stage.addChild(self.square);bm.tween.to(self.square,{y:(bm.stage.height-self.square.height)/2},{duration:1000,ease:self.enterEase,onComplete:function(){self.createLRWords();self.lrTween();self.showFlowers()}})},createLRWords:function(){var self=this;self.left=new Hilo.Text({text:"Marry Me!",font:"30px 微软雅黑",color:"#779046",maxWidth:self.square.width,x:-(bm.stage.width-self.square.width)/2,y:self.square.y+40}).addTo(bm.stage);self.right=new Hilo.Text({text:"My Girl, DONG!",font:"30px 微软雅黑",color:"#779046",maxWidth:self.square.width,x:bm.stage.width,y:self.square.y+120}).addTo(bm.stage)
},lrTween:function(){var self=this;bm.tween.to(self.left,{x:(bm.stage.width-120)/2},{duration:1000,delay:5,ease:self.enterEase});bm.tween.to(self.right,{x:(bm.stage.width-200)/2},{duration:1000,delay:5,ease:self.enterEase})},showFlowers:function(){var self=this;self.flower=self.toBitmap(bm.asset.get("rose"));self.flower.x=(bm.stage.width-50)/2;self.flower.y=self.left.y+35;self.flower.scaleX=0.8;self.flower.scaleY=0.8;self.flower.alpha=0;bm.stage.addChild(self.flower);bm.tween.to(self.flower,{alpha:1},{duration:1550,ease:self.enterEase,onComplete:function(){self.showILoveU()}})},showILoveU:function(){var self=this;self.iloveu=new Hilo.Text({text:"I  ❤️  U",font:"30px 微软雅黑",color:"#e23946",alpha:0,x:(bm.stage.width-50)/2,y:self.square.y+200}).addTo(bm.stage);bm.tween.to(self.iloveu,{x:self.iloveu.x-50,alpha:1,scaleX:1.8,scaleY:1.8},{duration:1500,delay:10,ease:self.enterEase,onComplete:function(){self.hide();bm.loadNext("s1")}})},hide:function(){var self=this;bm.tween.to(self.square,{alpha:0},{duration:1500,onComplete:function(){bm.stage.removeChild(self.square)}});bm.tween.to(this.left,{alpha:0},{duration:1500,onComplete:function(){bm.stage.removeChild(self.left)}});bm.tween.to(this.flower,{alpha:0},{duration:1500,onComplete:function(){bm.stage.removeChild(self.flower)}});bm.tween.to(this.right,{alpha:0},{duration:1500,onComplete:function(){bm.stage.removeChild(self.right)}});bm.tween.to(this.iloveu,{alpha:0},{duration:1500,onComplete:function(){bm.stage.removeChild(self.iloveu)}});bm.tween.to(this,{alpha:0},{duration:1500,onComplete:function(){bm.stage.removeChild(self)}})}})})(window.BM);(function(bm){var nexts1=bm.scenes.nexts1=Hilo.Class.create({Extends:Hilo.Container,Mixes:Hilo.EventMixin,enterEase:Hilo.Ease.Linear.EaseNone,outEase:Hilo.Ease.Linear.EaseNone,constructor:function(bg){this.bmp=this.toBitmap(bg);nexts1.superclass.constructor.call(this,{children:[this.bmp]});this.alpha=0;this.width=this.bmp.width;this.height=this.bmp.height},toBitmap:function(img){var content=img.content;return new Hilo.Bitmap({id:img.id,image:content,width:content.width,height:content.height,rect:[0,0,content.width,content.height]})},start:function(){var self=this;bm.tween.to(self,{alpha:1},{duration:1500,ease:self.enterEase,onComplete:function(){self.leftToRight()}})},leftToRight:function(){var self=this;bm.tween.to(self,{alpha:1,x:-self.width/3},{duration:6000,ease:self.enterEase,onComplete:function(){self.rightToLeft()}})},rightToLeft:function(){var self=this;bm.tween.to(self,{alpha:0.8,x:0},{duration:6000,ease:self.enterEase,onComplete:function(){self.hide()}})},hide:function(){var self=this;bm.tween.to(self,{alpha:0},{duration:3000,ease:self.outEase,onStart:function(){bm.loadNext("s2")},onComplete:function(){bm.stage.removeChild(self)}})}})})(window.BM);(function(bm){var nexts2=bm.scenes.nexts2=Hilo.Class.create({Extends:Hilo.Container,Mixes:Hilo.EventMixin,enterEase:Hilo.Ease.Linear.EaseNone,outEase:Hilo.Ease.Linear.EaseNone,constructor:function(bg){this.bmp=this.toBitmap(bg);nexts2.superclass.constructor.call(this,{children:[this.bmp]});this.alpha=0.1;this.scaleX=1.2;this.scaleY=1.2;this.x=-100;this.y=-100;this.width=this.bmp.width;this.height=this.bmp.height},toBitmap:function(img){var content=img.content;return new Hilo.Bitmap({id:img.id,image:content,width:content.width,height:content.height,rect:[0,0,content.width,content.height]})},start:function(){var self=this;bm.tween.to(self,{x:0,y:0,depth:1,alpha:1},{duration:3000,delay:100,ease:self.enterEase,onComplete:function(){self.back()}})},back:function(){var self=this;bm.tween.to(self,{scaleX:1,scaleY:1},{duration:2500,ease:self.enterEase,onComplete:function(){self.hide()}})},hide:function(){var self=this;bm.tween.to(self,{alpha:0},{duration:4500,ease:self.outEase,onStart:function(){bm.loadNext("s3")},onComplete:function(){bm.stage.removeChild(self)}})}})})(window.BM);(function(bm){var nexts3=bm.scenes.nexts3=Hilo.Class.create({Extends:Hilo.Container,Mixes:Hilo.EventMixin,enterEase:Hilo.Ease.Linear.EaseNone,outEase:Hilo.Ease.Linear.EaseNone,constructor:function(bg){this.bmp=this.toBitmap(bg);nexts3.superclass.constructor.call(this,{children:[this.bmp]});this.x=100;this.alpha=0;this.depth=2;this.width=this.bmp.width;this.height=this.bmp.height},toBitmap:function(img){var content=img.content;return new Hilo.Bitmap({id:img.id,image:content,width:content.width,height:content.height,rect:[0,0,content.width,content.height]})},start:function(){var self=this;bm.tween.to(self,{x:-(self.width-bm.stage.width),alpha:1,},{duration:7000,ease:self.enterEase,onComplete:function(){self.hide()}})},hide:function(){var self=this;bm.tween.to(self,{x:-self.width,alpha:0},{duration:5000,delay:1500,ease:self.outEase,onStart:function(){bm.loadNext("s4")},onComplete:function(){bm.stage.removeChild(self)}})}})})(window.BM);(function(bm){var nexts4=bm.scenes.nexts4=Hilo.Class.create({Extends:Hilo.Container,Mixes:Hilo.EventMixin,enterEase:Hilo.Ease.Linear.EaseNone,outEase:Hilo.Ease.Linear.EaseNone,constructor:function(bg){this.bmp=this.toBitmap(bg);
nexts4.superclass.constructor.call(this,{children:[this.bmp]});this.x=bm.stage.width;this.alpha=0.2;this.width=this.bmp.width;this.height=this.bmp.height},toBitmap:function(img){var content=img.content;return new Hilo.Bitmap({id:img.id,image:content,width:content.width,height:content.height,rect:[0,0,content.width,content.height]})},start:function(){var self=this;bm.tween.to(self,{x:-150,alpha:1},{duration:6000,ease:self.enterEase,onComplete:function(){self.hide()}})},hide:function(){var self=this;bm.tween.to(self,{alpha:0},{duration:1000,delay:1500,ease:self.outEase,onStart:function(){bm.loadNext("s5")},onComplete:function(){bm.stage.removeChild(self)}})}})})(window.BM);(function(bm){var nexts5=bm.scenes.nexts5=Hilo.Class.create({Extends:Hilo.Container,Mixes:Hilo.EventMixin,enterEase:Hilo.Ease.Linear.EaseNone,outEase:Hilo.Ease.Linear.EaseNone,constructor:function(bg){this.left=this.toBitmap(bg);this.right=this.toBitmap(bg);nexts5.superclass.constructor.call(this,{children:[this.left,this.right]});this.height=bm.stage.height;this.x=-this.left.width/2;this.background="#000";this.left.x=120;this.left.alpha=0.7;this.right.x=bm.stage.width+this.left.width/2;this.right.alpha=0;this.isFinished=0;this.isHided=0},toBitmap:function(img){var content=img.content;return new Hilo.Bitmap({id:img.id,image:content,width:content.width,height:content.height,rect:[0,0,content.width,content.height]})},start:function(){var self=this;bm.tween.to(self.left,{x:this.left.width/2,alpha:1},{duration:2000,ease:self.enterEase,onComplete:function(){self.hide()}});bm.tween.to(self.right,{x:this.left.width/2,alpha:0.2},{duration:2000,ease:self.enterEase,onComplete:function(){self.hide()}})},hide:function(){var self=this;if(!self.finished()){return}bm.tween.to(self.left,{alpha:0},{duration:2000,delay:1200,ease:self.outEase,onStart:function(){if(!self.hided()){return}bm.loadNext("s6")},onComplete:function(){bm.stage.removeChild(self.left)}});bm.tween.to(self.right,{alpha:0},{duration:3000,delay:1200,ease:self.outEase,onStart:function(){if(!self.hided()){return}bm.loadNext("s6")},onComplete:function(){bm.stage.removeChild(self.right)}})},finished:function(){this.isFinished+=1;if(this.isFinished!==2){return false}return true},hided:function(){this.isHided+=1;if(this.isHided!==2){return false}return true}})})(window.BM);(function(bm){var nexts6=bm.scenes.nexts6=Hilo.Class.create({Extends:Hilo.Container,Mixes:Hilo.EventMixin,enterEase:Hilo.Ease.Linear.EaseNone,outEase:Hilo.Ease.Linear.EaseNone,constructor:function(bg){this.bmp=this.toBitmap(bg);nexts6.superclass.constructor.call(this,{children:[this.bmp]});this.scaleX=0.1;this.scaleY=0.1;this.x=bm.stage.width-100;this.y=bm.stage.height-100;this.width=this.bmp.width;this.height=this.bmp.height},toBitmap:function(img){var content=img.content;return new Hilo.Bitmap({id:img.id,image:content,width:content.width,height:content.height,rect:[0,0,content.width,content.height]})},start:function(){var self=this;bm.tween.to(self,{x:0,y:0,scaleX:1,scaleY:1},{duration:3000,ease:self.enterEase,onComplete:function(){self.hide()}})},hide:function(){var self=this;bm.tween.to(self,{alpha:0},{duration:4000,delay:1500,ease:self.outEase,onStart:function(){bm.loadNext("s7")},onComplete:function(){bm.stage.removeChild(self)}})}})})(window.BM);(function(bm){var nexts7=bm.scenes.nexts7=Hilo.Class.create({Extends:Hilo.Container,Mixes:Hilo.EventMixin,enterEase:Hilo.Ease.Linear.EaseNone,outEase:Hilo.Ease.Linear.EaseNone,constructor:function(bg){this.bmp=this.toBitmap(bg);nexts7.superclass.constructor.call(this,{children:[this.bmp]});this.x=-200;this.y=this.bmp.height*0.1;this.alpha=0;this.width=this.bmp.width;this.height=this.bmp.height},toBitmap:function(img){var content=img.content;return new Hilo.Bitmap({id:img.id,image:content,width:content.width,height:content.height,rect:[0,0,content.width,content.height]})},start:function(){var self=this;bm.tween.to(self,{alpha:1,y:0,x:0},{duration:3000,ease:self.enterEase,onComplete:function(){console.log("over")}})}})})(window.BM);